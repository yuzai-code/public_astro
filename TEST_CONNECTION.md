# 测试连接功能说明

## 功能概述

测试连接功能允许你在发布文章之前验证 GitHub API 连接是否正常工作。这个功能会检查：

1. **GitHub Token 有效性** - 验证你的 Personal Access Token 是否有效
2. **仓库访问权限** - 确认你是否有权限访问指定的 GitHub 仓库
3. **内容目录状态** - 检查 Astro 内容目录是否存在

## 使用方法

### 方法一：在设置中测试

1. 打开思源笔记设置
2. 找到 "Publish to Astro Blog" 插件设置
3. 填写完整的 GitHub 配置信息：
   - GitHub Personal Access Token
   - GitHub 仓库所有者
   - GitHub 仓库名称
   - Astro 内容路径
4. 点击 "测试连接" 按钮
5. 等待测试结果

### 方法二：在发布对话框中测试

1. 打开要发布的文档
2. 点击 Astro 发布按钮或使用快捷键 `Shift+Cmd+P`
3. 在发布对话框中点击 "测试连接" 按钮
4. 查看测试结果

## 测试结果说明

### 成功情况

如果测试成功，你会看到类似以下的消息：

```
连接测试成功！
仓库: username/my-astro-blog ✓ 内容目录存在
```

或者：

```
连接测试成功！
仓库: username/my-astro-blog ⚠ 内容目录不存在，发布时将自动创建
```

### 失败情况

常见的错误及解决方法：

#### 1. 配置信息不完整
**错误**: "请先配置 GitHub 信息"
**解决**: 确保所有必需的配置字段都已填写

#### 2. Token 无效
**错误**: "HTTP 401" 或 "Bad credentials"
**解决**: 
- 检查 GitHub Token 是否正确
- 确认 Token 没有过期
- 验证 Token 具有 `repo` 权限

#### 3. 仓库不存在或无权限
**错误**: "HTTP 404" 或 "Not Found"
**解决**:
- 确认仓库名称和所有者是否正确
- 检查仓库是否为私有仓库（需要相应权限）
- 验证 Token 是否有访问该仓库的权限

#### 4. 网络连接问题
**错误**: "Network error" 或超时
**解决**:
- 检查网络连接
- 确认可以访问 GitHub API
- 尝试稍后重试

## 技术细节

测试连接功能执行以下操作：

1. **仓库信息获取**
   ```
   GET https://api.github.com/repos/{owner}/{repo}
   ```
   验证仓库存在且可访问

2. **内容目录检查**
   ```
   GET https://api.github.com/repos/{owner}/{repo}/contents/{path}
   ```
   检查指定的内容目录是否存在

## 故障排除

### 测试按钮无响应

1. 检查浏览器控制台是否有错误信息
2. 确认所有配置字段都已填写
3. 尝试刷新页面重新测试

### 测试一直显示"正在测试..."

1. 检查网络连接
2. 查看浏览器网络标签页是否有请求失败
3. 尝试取消并重新测试

### 测试成功但发布失败

1. 确认 Token 具有写入权限
2. 检查仓库的分支设置（默认分支应为 `main`）
3. 验证内容路径是否正确

## 最佳实践

1. **首次配置后立即测试** - 在完成 GitHub 配置后立即进行测试
2. **定期测试** - 如果 Token 有过期时间，建议定期测试
3. **发布前测试** - 在发布重要文章前先测试连接
4. **保存配置** - 测试成功后记得保存设置

## 安全提示

- GitHub Token 是敏感信息，请妥善保管
- 不要在公共场所或截图中暴露 Token
- 建议为插件创建专门的 Token，并设置最小必要权限
- 定期轮换 Token 以提高安全性
